name: Deploy to Railway

on:
  push:
    branches: [main]

# Use Railway's native GitHub integration
# Go to: https://railway.app/project/c6a9d92e-4343-4545-9efc-a80a488abb0d/settings
# And connect GitHub repo for auto-deploy
#
# OR use webhook deployment trigger:
jobs:
  trigger-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Trigger Railway Deployment via Webhook
        run: |
          curl -X POST \
            -H "Authorization: Bearer ${{ secrets.RAILWAY_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{"query": "mutation { serviceInstanceDeploy(serviceId: \"e534cadd-4425-4f3c-9374-5b30373b6ff1\", environmentId: \"625d3069-5850-4712-8a3a-d81a1c091cd1\") }" }' \
            https://backboard.railway.com/graphql/v2
      
      - name: Trigger Workers Deploy
        run: |
          curl -X POST \
            -H "Authorization: Bearer ${{ secrets.RAILWAY_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{"query": "mutation { serviceInstanceDeploy(serviceId: \"448a2e6d-f4b8-4158-a3fe-68ab8bb2908f\", environmentId: \"625d3069-5850-4712-8a3a-d81a1c091cd1\") }" }' \
            https://backboard.railway.com/graphql/v2
      
      - name: Trigger Frontend Deploy
        run: |
          curl -X POST \
            -H "Authorization: Bearer ${{ secrets.RAILWAY_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{"query": "mutation { serviceInstanceDeploy(serviceId: \"fae8ec68-9e28-4c95-97ed-1a09f74f1f96\", environmentId: \"625d3069-5850-4712-8a3a-d81a1c091cd1\") }" }' \
            https://backboard.railway.com/graphql/v2
